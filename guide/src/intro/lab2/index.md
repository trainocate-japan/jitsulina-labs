---
sidebar: auto
title: 演習2 目次
---

[入門編の目次に戻る](../index.md)

### 実務で使えるLinux 入門編 演習手順

演習2【基本的なシェルの操作】
==

## 概要

- ワイルドカードによる複数ファイルの一括処理方法を学びます
- リダイレクションとパイプライン、連続実行による効率的なコマンド利用方法を学びます
- エイリアスの利用方法を学びます

## 所要時間

20分
> オプション問題の実施は自由です。時間に余裕がある場合は実施してください（これまでの講義で取り扱っていない内容が含まれることもあります）

## 実施内容

- ワイルドカードの操作
- 出力リダイレクション（標準エラーの取り扱い）
- 出力リダイレクション（標準出力の取り扱い）
- パイプライン
- （オプション）コマンドの連続実行
- （オプション）エイリアス

## 演習手順
### 演習：ワイルドカードの操作
#### 1. ホームディレクトリに、lab2というディレクトリを作成してください。作成できたら、そのディレクトリに移動してください
> コマンドの連続実行を使っても構いません

  ::: details 解答例
  `cd && mkdir lab2 && cd lab2`
  :::

#### 2. /etcディレクトリにある、拡張子が .conf となっているファイルを全て、詳細情報も含めて表示してください

  ::: details 解答例
  `ls -l /etc/*.conf`
  :::

  ::: tip
  表示内容が長くウインドウからはみ出る場合は、ターミナルをスクロールしてください。環境によりスクロールできない場合は、moreコマンドをパイプするなどして対応しましょう
  :::

#### 3. /etcディレクトリにある、拡張子が .conf となっているファイルを全て、カレントディレクトリにコピーしてください。サブディレクトリまでは不要です

  ::: details 解答例
  `cp /etc/*.conf .`
  :::

### 演習：出力リダイレクション（標準エラーの取り扱い）

#### 1. ファイルコピーのコマンドを実行すると「許可がありません」というエラーが出ました。もう一度ファイルのコピーを実施し、エラーを errors.log ファイルに保管してください。シェルのヒストリ機能を使うと早く再実行できます

  ::: details 解答例
  `cp /etc/*.conf . 2> errors.log`
  <br>
  （2> の前後にスペースを忘れないようにしてください）
  <br>
  （エラーの内容を確認する場合は `cat errors.log` も実行）
  :::

#### 2. コマンド実行時のエラーは、表示やファイルへの保管が不要なことがあります。その際は、/dev/null ファイルに出力すると表示も保管もせず消すことが出来ます。今度はエラーを消去してみましょう

  ::: details 解答例
  `cp /etc/*.conf . 2> /dev/null`
  :::

  :::tip
  /dev/null は特殊なファイルで、書き込まれたデータを全て廃棄し、読み出しても何も返しません。コマンドの出力結果やエラーを破棄する場合や、ファイルを空にしたいときによく使います
  :::

### 演習：出力リダイレクション（標準出力の取り扱い）

#### 1. lab2ディレクトリ内のファイル一覧を、files.txt に取得します。その前に、files.txtに現在時刻とユーザー名を記録してください。ユーザー名を取得するコマンドは問いません

  ::: details 解答例
  - 以下のコマンドを続けて実行
  <br>
  `date > files.txt`
  <br>
  `id >> files.txt`
  :::

#### 2. lab2ディレクトリ内の詳細なファイル一覧を、files.txt に追記してください。正しく保存できているかも確認してください。ファイルの先頭に、時刻と作業者情報が記載されていることも確認してください

  ::: details 解答例
  - 以下のコマンドを続けて実行
  <br>
  `ls -l . >> files.txt`
  <br>
  `cat files.txt`
  :::

  :::tip
  リダイレクトをうまく使うと、作業結果のファイル（今回の場合はファイル一覧の取得）に作業時間や作業者名を残すことができます
  :::

  :::warning
  リダイレクトを間違えて上書きした場合は、時刻とユーザー名の記載からやりなおしてください
  :::

### 演習：パイプライン
#### 1. lab2ディレクトリには、/etcにあった設定ファイルが複数コピーされています。このファイルの中から、server という文字が含まれているファイルの一覧を表示してください。検索の際は大文字・小文字を区別せず、文字が含まれている行の行番号も表示してください

  ::: details 解答例
  `grep -in server *.conf`
  :::

#### 2. 先ほどの検索結果は何行あったでしょうか？ wcコマンドに -l オプションを付けると行数を表示できます。パイプをうまく使い、wcコマンドにgrepの結果を渡してください 

  ::: details 解答例
  `grep -in server *.conf|wc -l`
  :::

#### 3. 手順１と２の結果を、files.txtに追記してください。今回の追記の前に区切りの文字「-----」を挿入してみましょう。区切り文字は、echo "-----" を実行すると挿入できます。実行が終わったら、結果を確認してください

  ::: details 解答例
  - 以下のコマンドを続けて実行
  <br>
  `echo "-----" >> files.txt`
  <br>
  `grep -in server *.conf >> files.txt`
  <br>
  `grep -in server *.conf|wc -l >> files.txt`
  <br>
  `cat files.txt`
  :::

### （オプション）演習：コマンドの連続実行
#### 1. これまで行った以下の作業を1行のコマンドで実行できるよう、連続実行してください。ただし、連続実行中にエラーが出た場合はそこで実行を停止するようにしてください。ファイル名は、files2.txt としてください
  ```
  現在時刻とユーザー情報の記録
  ディレクトリ内のファイル一覧の記録
  区切りの文字「-----」の挿入
  serverという文字列を含んだファイルの表示、行数の確認と記録
  ```

  ::: details 解答例
  `date > files2.txt && id >> files2.txt && ls -l >> files2.txt && echo "-----" >> files2.txt && grep -in server *.conf >> files2.txt && grep -in server *.conf|wc -l >> files2.txt`
  :::

### （オプション）演習：エイリアス
#### 1. ところで、演習の最初でcpコマンドを何度か実施した際に、ファイルの上書き確認が出ませんでした。この動作はファイルを気づかず上書きしてしまうため危険です。すでに存在しているファイルを対象にcpコマンドを実行するときは上書き確認ができるように、cpコマンドに上書き確認のオプションを付けて実行してください。実行するコマンドは最初のと同じで構いません。なお上書きの確認ができたのであれば、途中で実行を止めても構いません

  ::: details 解答例
  `cp -i /etc/*.conf .`
  :::

#### 2. コピーの対象が多くある場合で、確実に上書きしてもいいときは yes コマンドとパイプを使って y の入力を自動化することもできます。以下のコマンドを実行して、上書き確認に y を自動応答してください

  ```
  `yes|cp -i /etc/*.conf .`
  ```

  :::tip
  yesコマンドは、y と改行を標準出力に出力するコマンドで、シェルスクリプトでの自動化などに使います。もっとも、コマンドに -y オプションがある際は使わなくても構いません
  :::

#### 3. ファイルをコピーする際は必ず上書き確認されるようにしたいです。cpと実行した際に、cp -i オプション付きで実行されるよう、エイリアスを設定してください。最後に設定されたことを確認してください。確認方法は問いません

  ::: details 解答例
  - 以下のコマンドを続けて実行
  <br>
  `alias cp='cp -i'`
  <br>
  `alias|grep cp`
  :::

#### 4. エイリアスの設定に問題がないか、コピーするファイルは何でも構わないので動作確認をしてください

  ::: details 解答例
  `cp /etc/resolv.conf .`
  <br>
  上書き確認が表示されればよい
  :::

  :::tip
  aliasコマンドで設定したエイリアスは操作中のシェルのみ有効なため、別のシェルを起動したりログアウトすると消えます。永続的にエイリアスを設定するには.bashrcなどの設定ファイルに書き込む必要があります
  :::

#### 5. （オプション）rootユーザーでの作業は危険なため、一般ユーザーとは異なるエイリアスが設定されています。rootユーザーのエイリアス設定を確認してください。エイリアスは、rootユーザーのホームディレクトリ（/root）にある .bashrc に設定されています

  ::: details 解答例
  `sudo cat /root/.bashrc|grep alias`
  <br>
  ※sudoコマンドは第４章で紹介します。環境によってはsudoが使えないこともあるので、su - でrootユーザーに変更してください
  :::

## 演習終了

- 以上で演習2は終了です。お疲れ様でした。早く終わった方は、復習や周りのメンバーのヘルプを行いましょう

---
[入門編の目次に戻る](../index.md)

<br>

[トップページに戻る](../../index.md)
