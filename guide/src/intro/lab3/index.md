---
sidebar: auto
title: 演習3 目次
---

[入門編の目次に戻る](../index.md)

### 実務で使えるLinux 入門編
演習3【アカウント管理】
==

## 概要
- システム管理作業で必要となる、ユーザーとグループの管理作業を学びます
- 2章で学んだパーミッションの効果もこちらで確認します

## 所要時間
30分

## 実施内容
- ユーザーとグループの状況確認
- 新規ユーザーの作成とユーザーの変更
- パーミッションの動作確認
- グループの動作確認 

## 演習手順
### 演習：ユーザーとグループの状況確認
#### 1. 現在ログインしているユーザーの情報を詳細に表示してください。少なくともユーザーIDと所属グループは表示してください

  ::: details 解答例
  `id`
  :::

#### 2. 演習環境のLinuxに登録済みのユーザー一覧を表示してください。方法は問いません

  ::: details 解答例
  `cat /etc/passwd`
  :::

#### 3. 演習環境のLinuxに登録済みのグループ一覧を表示してください。方法は問いません

  ::: details 解答例
  `cat /etc/group`
  :::

#### 4. 次は、ec2-userが所属しているグループだけを表示してください。方法は問いません

  ::: details 解答例
  `cat /etc/group|grep ec2-user`
  :::

### 演習：新規ユーザーの作成
#### 1. 以降の作業は、当面 root ユーザ−で実施します。以下のコマンドでrootユーザーになってください。パスワードを聞かれた場合は、ec2-userのパスワードを入力してください。最後に、rootユーザーになったことを確認してください。方法は問いません
  ```
  sudo su -
  ```
  あるいは、
  ```
  su - を実行し、パスワードで password を入力
  ```

  :::tip
  ディストリビューションや設定によって rootユーザーへの変更方法は異なります。また、rootユーザーにパスワードが設定されてないこともあります。その場合はsudoコマンドでのみroot権限を行使できます。rootユーザーにパスワードが設定されていないのは、rootユーザーへの変更を出来ないようにするというセキュリティ上の理由のため、むやみにパスワードは設定しないほうがよい場合もあります
  :::

#### 2. user1 という新規ユーザーを作成してください。ホームディレクトリはユーザー名と同じ、シェルはBash、グループの指定は不要です。

  ::: details 解答例
  `useradd user1 -m -s /bin/bash`
  :::

#### 3. ユーザーが作成されたことを確認してください。方法は問いません

  ::: details 解答例
  `cat /etc/passwd`
  :::

#### 4. exitコマンドを実行して、ec2-userに戻ってください

  :::tip
  suコマンドでユーザーを変更すると、そのユーザーで新たにシェルが起動しています。exitコマンドでそのシェルを終了させることで、元のユーザーに戻ることができます
  :::

  :::tip
  以降の作業でroot権限が必要な場合は、rootユーザーへの変更ではなくsudoコマンドを使っても構いません。実際の業務では、root権限の利用を許可していないこともありますので現場のルールを確認してください
  :::

#### 5. ec2-user に戻ったことが確認できたら、user1ユーザーに切り替えてください

  ::: details 解答例
  `su - user1`
  <br>
  しかし結果は、、、
  :::

#### 6. 前のコマンドは失敗するか、作業が完了できなかったと思います。なぜでしょうか？

  ::: details 解答例
  user1にはパスワードが設定されていないため、ログインができない
  :::

#### 7. user1にパスワードを設定してください。パスワードは忘れなければ何でも構いません（password など）。ただし、現在ec2-userのため、権限を変更しないと作業出来ないはずです。

  ::: details 解答例
  `sudo passwd user1`
  :::

  :::danger
  通常、password のような簡単なパスワードの利用は現場で許可されていません。演習環境はインターネットなど外部からは遮断されているため特別に許可されていると考えてください
  :::

#### 8. 無事パスワードの変更ができたら、user1ユーザーに変更してください

  ::: details 解答例
  `su - user1`
  :::

### 演習：パーミッションとグループ

::: tip
ここで取り扱うコマンドは、2章で紹介したものが含まれます。グループの操作コマンドを思い出しながら進めてみましょう
:::

#### 1. user1とec2-userで共有したいファイルやディレクトリがあるとします。ひとまず、ec2-userのホームディレクトリの内容を表示してください。結果はどうでしたか？

  ::: details 解答例
  `ls /home/ec2-user`
  <br>
  上記を実行しても、許可がない (Permission denied) というエラーで参照できない
  :::

#### 2. 問題を解決するために必要な手続きを考えてください。考えた後、解答例を見てください

  ::: details 解答例
  ec2-userとuser1を同じグループに所属させる
  <br>
  そのグループで利用できるパーミッションを持つ共有のディレクトリを用意する
  :::

  :::tip
  ec2-userのディレクトリ内に他のユーザーからアクセスできるディレクトリを作るという手法もあります。しかしホームディレクトリは一般的にそのユーザー専用のディレクトリであるため、別途共有用のディレクトリを用意することが多いです
  :::

#### 3. 以降の作業はroot権限が必要なものがあります。rootユーザーに変更してください。方法は問いません。ただし、user1からは、環境によってはrootユーザーに変更ができないかもしれません。コマンドを考えて実行してみましょう

  ::: details 解答例
  `exit`を実行してから、`sudo su -`
  <br>
  ※user1にはsudoの権限がないため、上記例ではまずec2-userに戻ってからsudoを実行している
  :::

  ::: tip
  実際の業務ではrootでの作業は禁止されている場合もあるため、su - による変更は出来ないケースもあることを覚えておきましょう。rootユーザーにパスワードが設定されていないディストリビューションも多くあります
  :::

#### 4. ec-2userとuser1を所属させるグループを作成してください。グループ名は「common」としてください

  ::: details 解答例
  `groupadd common`
  :::

#### 5. 共有ディレクトリを作成します。/optディレクトリ内に shared ディレクトリを作成してください

  ::: details 解答例
  `mkdir /opt/shared`
  :::

#### 6. /opt/sharedディレクトリのグループを、commonグループに変更してください

  ::: details 解答例
  `chgrp common /opt/shared`
  :::

#### 7. ここまでの作業内容を確認してください。/opt/sharedディレクトリのグループがcommonになっているはずです

  ::: details 解答例
  `ls -ld /opt/shared`
  :::

#### 8. このままでは、commonグループのメンバーでは書き込みが行えません。ディレクトリのグループのパーミッションを rwx に変更してください

  ::: details 解答例
  `chmod g+w /opt/shared`
  :::

#### 9. これまでの作業結果を確認してください。/opt/sharedディレクトリのグループがcommonで、権限がrwxになっているはずです。確認の方法は問いません
  ::: details 解答例
  `ls -ld /opt/shared`
  ::: 

#### 10. 共有ディレクトリの準備ができました。次に、ec2-userとuser1を、common グループに参加させてください

  ::: details 解答例
  - 以下のコマンドを続けて実行
  <br>
  `usermod -aG common ec2-user`
  <br>
  `usermod -aG common user1`
  :::

#### 11. rootユーザーの権限での作業はここで終了です。rootユーザーで作業していた場合は、exitコマンドを実行してec2-userのシェルに戻ってください

#### 12. /opt/sharedディレクトリに、ファイル名や手段は何でもよいのでファイルを作成し、作成されたことを確認してください。うまくできたでしょうか？

  ::: details 解答例
  許可がありません (Permission denied) と表示され、うまくいかない
  <br>
  もしかすると、Permission denied が表示されずファイルが作成できたかもしれません。さて、それはなぜでしょうか？ひとまず先に進んでみてください
  ::: 

#### 13. idコマンドでユーザーの情報を表示し、うまく行かなかった原因を考えてから解答例を見てください。エラーが出なかった方も解答例を読んでください

  ::: details 解答例
  前の手順でエラーが出た → ec2-userが所属するグループにcommonが含まれていないため、権限がなく失敗している。ec2-userをcommonグループに所属させる処理（usermod）を行っただけでは、ec2-userはcommonグループには所属していないことがわかる
  <br>
  usermodでグループ設定を変更した場合は、再度そのユーザーでログインしなおすかsuコマンドでユーザーを切り替える必要がある
  <br>
  <br>
  前の手順でエラーが出ずファイル作成が成功した → idコマンドの表示結果に、commonグループが含まれているはず。前の手順までの作業で、usermodコマンドの実行結果をec2-userに反映させるような、何らかの処理を行ったと思われる。気になる場合は、historyコマンドなどで確認してみましょう。rootからexitせずsu - ec2-userコマンドを実行した場合も該当します
  :::

#### 14. 上記の対策をとってから、再度/opt/sharedディレクトリにファイルを作成してみてください。今度はうまくいくはずです。前の手順でエラーが出なかった方は、この手順は飛ばしても構いません
  
  ::: details 解答例
  `exit` してログインし直す、もしくは再度、`su - ec2-user`する、など
  <br>
  `vi /opt/shared/hoge`、など (`cp`でもよい)
  ::: 

#### 15. user1にユーザーを変更し、同様に/opt/sharedディレクトリにファイルを作成してみてください

  ::: details 解答例
  `su - user1`を実行してから、`vi /opt/shared/moge`を実行する、など
  :::

#### 16. ec2-userに戻り、user1ユーザーを、ディレクトリも含めて削除しておいてください

  ::: details 解答例
  `sudo userdel -r user1`
  ::: 

  :::warning
  これまでの進め方によっては、user1の削除に失敗するかもしれません。エラーメッセージをよく読んで対処しましょう
  :::

## 演習終了
- 以上で演習3は終了です。お疲れ様でした。早く終わった方は、復習や周りのメンバーのヘルプを行いましょう

---
[入門編の目次に戻る](../index.md)
<br>

 [トップページに戻る](../../index.md)