---
sidebar: auto
title: 目次 
---

### 実務で使えるLinux 入門編
演習5【ネットワーク管理】
==

## 概要
- ipコマンドやnmcliコマンドによるネットワーク設定確認の基礎を学びます
- 疎通確認についての基礎知識を学びます
- ネットワーク状態の確認方法を学びます
- 設定ファイルの編集とその影響を学びます

## 所要時間
30分

## 実施内容
- 演習：ipコマンドによるネットワーク設定確認
- 演習：nmcliコマンドによるネットワーク設定確認
- 演習：疎通確認
- 演習：ネットワーク状態の確認
- 演習：ネットワーク設定ファイルの編集

:::danger
クラウド環境での演習の場合、ネットワークの設定を間違えると接続が切れたり再接続が不能になり復旧に時間がかかることがあります。十分注意しながら進めてください
:::

## 演習内容
### 演習：ipコマンドによるネットワーク設定確認
#### 1. 演習環境のホスト名のフルネーム（FQDN）を確認してください。方法は問いません

  ::: details 解答例
  hostname 
  <br>
  hostnamectl status
  <br>
  など
  :::

#### 2. 演習環境に設定されているIPアドレスを、ipコマンドで確認してください

  ::: details 解答例
  ip addr
  :::

#### 3. 演習環境に設定されているルーティングテーブル情報をipコマンドで表示し、デフォルトゲートウェイのIPアドレスを確認してください

  ::: details 解答例
  ip route
  <br>
  :::

#### 4. ipコマンドの出力結果から、演習環境に設定されているDNSサーバーのアドレスを確認してください

  ::: details 解答例
  ipコマンドではDNSサーバーのアドレスは確認できない
  :::

#### 5. 演習環境に設定されているDNSサーバーのアドレスを確認してください。方法は問いません。確認したDNSサーバーのアドレスは後で使うので記録するか、表示できるようにしておいてください

  ::: details 解答例
  cat /etc/resolv.conf
  <br>
  nmcli device show
  <br>
  など
  :::

### 演習：nmcliコマンドによるネットワーク設定確認
#### 1. 演習環境に設定されているIPアドレスを、nmcliコマンドで確認してください

  ::: details 解答例
  nmcli
  <br>
  nmcli device show
  <br>
  nmcli connection show
  <br>
  など
  :::

  :::tip
  nmcliコマンドでは、物理的なインターフェースであるdeviceと、論理的なインターフェースであるconnectionの2種類のインターフェースを取り扱います。通常、ネットワークの設定を行う際はconnectionに対して行います。このコースでは取り上げませんが、複数の物理インターフェースを束ねて冗長化を行うボンディング設定などを行う際は、deviceとconnecionを明確に分けて意識する必要があります
  :::

### 演習：疎通確認
#### 2. 以下のコマンドを実行して、インターネット上のWebサイトにアクセスしてください。どのような結果になるでしょうか？
  
  ```
  curl http://example.com
  ```

  ::: details 解答例
  HTMLが表示される
  <br>
  <!doctype html>... から始まる結果が表示されれば問題ありません
  <br>
  example.comドメインが名前解決され、インターネット上のホストへWebアクセスできたことがわかります
  :::

#### 3. pingコマンドを利用して、先ほど確認したDNSサーバーのアドレスにpingを実行してください。どんな結果になりましたか？
  
  ::: details 解答例
  ping 10.0.0.2
  <br>
  PING 10.0.0.02 (10.0.0.2) 56(84) bytes of data.
  <br>
  応答なし、、、
  <br>
  <br>
  DNSサーバーによって、pingの応答がある場合もあれば、応答がない場合もある
  :::

  :::tip
  DNSサーバーとしての機能と、pingに応答するかは別の話です。以下はGoogleのパブリックDNSサーバーへのpingですが、問題なく応答が返っています<br>
  [ec2-user@ip-10-0-1-207 ~]$ ping 8.8.8.8
  <br>
  PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
  <br>
  64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=1.05 ms
  <br>
  64 bytes from 8.8.8.8: icmp_seq=2 ttl=112 time=1.07 ms
  <br>
  <br>
  DNSサーバー側で応答を拒否していたり、途中のネットワーク機器（ファイアーウォールなど）がpingを通さない場合、DNSは機能してもpingの応答は返りません。pingによる疎通確認は当てにならないことがあることを覚えておきましょう
  :::

### 演習：ネットワーク状態の確認
#### 1. ネットワークの接続状態を確認してください。取得する情報は、TCP/UDPの両方、サービス名の名前解決はなし、ホストが待ち受けしているポートのみ、です

  ::: details 解答例
  ss -nutl
  :::

#### 2. Webサーバー（httpd）をインストールして起動してください
  
  ::: details 解答例
  sudo dnf install -y httpd
  <br>
  sudo systemctl start httpd
  :::

#### 3. 再び、ネットワークの接続状態を確認してください。Webサーバーを起動したことにより、何が変わったでしょうか？

  ::: details 解答例
  ss -nutl
  <br>
  *:80 という記載が増え、tcp/80ポートでWebサーバーが接続待ちであることがわかります
  :::

### 演習：ネットワーク設定ファイルの編集
#### 1. /etc/hostsファイルの末尾に、以下を追記してください。追記したあと、間違いが無いかをファイルを表示して確認してください
  ```
  169.254.169.254 example.com
  ```

  ::: details 解答例
  sudo vi /etc/hosts
  <br>
  cat /etc/hosts
  <br>
  以下のようになっていればよい
  ```
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  169.254.169.254 example.com
  ```
  :::

#### 2. 先ほどと同じように、exmaple.comにアクセスしてください。どのような結果になるでしょうか？
  ```
  curl http://example.com
  ```
  ::: details 解答例
  何も表示されないか、先ほどとは違う結果となる
  :::

  :::tip
  結果が返ってこない場合は、Ctrl+Cキーでcurlコマンドの動作を停止してください
  :::

#### 3. 違う結果になった原因を考察してください
  ::: details 解答例
  nsswitch.confに、DNSサーバーよりも/etc/hostsファイルの中身を優先する設定が既定ではいっており、exmaple.comが169.254.169.254と名前解決され、違うサーバー（もしくは存在しないアドレス）にアクセスが発生していた
  :::

  :::tip
  169.254.169.254は、IPv4リンクローカルという特殊なアドレスで、通常の通信に使われることはほぼありません。DHCPでのアドレス割り振りに失敗した際などに使われます。Amazon EC2では、クラウド側の情報を取得できる特殊なアドレスとして使われますので、curlコマンドでのアクセスの際は結果が表示されますが、一般的な環境では存在しないアドレスのため結果は返ってこず無応答となります
  :::

#### 4. /etc/hostsの中身を元に戻しておいてください


<!--
### 演習：ネットワーク設定の変更
#### 1. 

  ::: details 解答例
  ip addr
    nmcli device show
  :::
-->



- 以上で演習5は終了です。お疲れ様でした。早く終わった方は、復習や周りのメンバーのヘルプを行いましょう

---
[入門編の目次に戻る](../index.md)
<br>

[トップページに戻る](../../index.md)